<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="IndustrialControlMAUI.Pages.InboundMoldPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             Shell.NavBarIsVisible="True">

    <Grid RowDefinitions="Auto,Auto,*,Auto,Auto" >

        <Grid Grid.Row="0" BackgroundColor="#007BFF" HeightRequest="60" Padding="16,0">
            <Label Text="仓储管理系统"
                   VerticalOptions="Center"
                   TextColor="White"
                   FontSize="18"
                   FontAttributes="Bold"/>
        </Grid>

        <!-- 扫描输入行 -->
        <Grid Grid.Row="1" ColumnDefinitions="*,40" ColumnSpacing="8" Padding="16,0">
            <Entry x:Name="ScanEntry"
                   Placeholder="请扫描/输入模具编码"
                   Text="{Binding ScanCode}"
                   ReturnType="Done"
                   Completed="OnScanCompleted"
                   WidthRequest="300"
                   />
            <ImageButton  Grid.Column="1"
                    Source="scan_button.png"      
                    WidthRequest="36"
                     HeightRequest="36"
                     BackgroundColor="Transparent"
                     Padding="0"
                     Aspect="AspectFit"
                     Clicked="OnScanClicked"  /> 
        </Grid>

        <!-- 模具状态信息（绿色卡片，仅加入“使用中”的记录） -->
        <VerticalStackLayout Grid.Row="2" Spacing="8">
            <Label Text="模具状态信息" FontAttributes="Bold"/>
            <CollectionView ItemsSource="{Binding MoldStatusList}" SelectionMode="Single">
                <CollectionView.SelectedItem>
                    <Binding Path="SelectedRow" Mode="TwoWay"/>
                </CollectionView.SelectedItem>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Padding="10"
                       HasShadow="False"
                       BackgroundColor="White" 
                       BorderColor="#18A558"
                       CornerRadius="8">

                            <!-- 勾选后整卡片变绿 -->
                            <Frame.Triggers>
                                <DataTrigger TargetType="Frame" Binding="{Binding IsSelected}" Value="True">
                                    <Setter Property="BackgroundColor" Value="#18A558"/>
                                    <Setter Property="BorderColor" Value="#18A558"/>
                                </DataTrigger>
                            </Frame.Triggers>

                            <!-- 统一文字颜色：默认深色，勾选后变白 -->
                            <Frame.Resources>
                                <Style TargetType="Label">
                                    <Setter Property="TextColor" Value="#222222"/>
                                    <Style.Triggers>
                                        <DataTrigger TargetType="Label" Binding="{Binding IsSelected}" Value="True">
                                            <Setter Property="TextColor" Value="White"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Frame.Resources>

                            <Grid x:Name="CardGrid"
                          RowDefinitions="Auto,Auto,Auto"
                          ColumnDefinitions="Auto,70,70,80,1.6*"
                          ColumnSpacing="10" RowSpacing="6">

                                <!-- 勾选（第0列） -->
                                <CheckBox Grid.RowSpan="3" Grid.Column="0"
                                  IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                  CheckedChanged="OnRowCheckedChanged"/>

                                <!-- 第1行：编码 + 型号 -->
                                <Label Grid.Column="1" Text="模具编码：" FontAttributes="Bold"/>
                                <Label Grid.Column="2" Text="{Binding MoldCode}"/>

                                <Label Grid.Column="3" Text="模具型号：" FontAttributes="Bold"/>
                                <Label Grid.Column="4" Text="{Binding MoldModel}" 
                               LineBreakMode="TailTruncation" MaxLines="1"/>

                                <!-- 第2行：状态 + 工单号 -->
                                <Label Grid.Row="1" Grid.Column="1" Text="使用状态：" FontAttributes="Bold"/>
                                <Label Grid.Row="1" Grid.Column="2" Text="{Binding UseStatusText}"/>

                                <Label Grid.Row="1" Grid.Column="3" Text="当前关联工单号：" FontAttributes="Bold"/>
                                <Label Grid.Row="1" Grid.Column="4" Text="{Binding WorkOrderNo}" 
                               LineBreakMode="TailTruncation" MaxLines="1"/>

                                <!-- 第3行：出库日期 + 库位 -->
                                <Label Grid.Row="2" Grid.Column="1" Text="出库日期：" FontAttributes="Bold"/>
                                <Label Grid.Row="2" Grid.Column="2" Text="{Binding OutstockDate}"/>

                                <Label Grid.Row="2" Grid.Column="3" Text="库位：" FontAttributes="Bold"/>
                                <Label Grid.Row="2" Grid.Column="4" Text="{Binding Location}" 
                               LineBreakMode="TailTruncation" MaxLines="1"/>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>


        <!-- 底部操作按钮 -->
        <Grid Grid.Row="4" ColumnDefinitions="*,*" Padding="16,8" ColumnSpacing="10">

            <Grid Grid.Column="0" BackgroundColor="#F44336" HeightRequest="50">
                <Grid.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding CancelScanCommand}" />
                </Grid.GestureRecognizers>
                <StackLayout Orientation="Horizontal" HorizontalOptions="Center" VerticalOptions="Center">
                    <Image Source="cancel.png" HeightRequest="20" WidthRequest="20" />
                    <Label Text="取消扫描" Margin="5,0,0,0" VerticalOptions="Center" TextColor="White" />
                </StackLayout>
            </Grid>

            <Grid Grid.Column="1" BackgroundColor="#2196F3" HeightRequest="50">
                <Grid.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding ConfirmInboundCommand}" />
                </Grid.GestureRecognizers>
                <StackLayout Orientation="Horizontal" HorizontalOptions="Center" VerticalOptions="Center">
                    <Image Source="confirm.png" HeightRequest="20" WidthRequest="20" />
                    <Label Text="确认入库" Margin="5,0,0,0" VerticalOptions="Center" TextColor="White" />
                </StackLayout>
            </Grid>

        </Grid>
    </Grid>
</ContentPage>
