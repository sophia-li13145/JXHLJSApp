<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Name="ThisPage"
    x:Class="IndustrialControlMAUI.Pages.InspectionRunDetailPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:vm="clr-namespace:IndustrialControlMAUI.ViewModels"
    xmlns:conv="clr-namespace:IndustrialControlMAUI.Converters"
    Title="ç‚¹å·¡æ£€æ‰§è¡Œ">

    <ContentPage.Resources>
        <ResourceDictionary>
            <conv:StringToNullableDecimalConverter x:Key="DecConv" />
            <Style x:Key="PrimaryBtn" TargetType="Button">
                <Setter Property="HeightRequest" Value="36" />
                <Setter Property="CornerRadius" Value="8" />
                <Setter Property="Padding" Value="18,6" />
                <Setter Property="TextColor" Value="White" />
                <Setter Property="BackgroundColor" Value="#2F80ED" />
                <Setter Property="FontAttributes" Value="Bold" />
            </Style>
            <Style x:Key="SuccessBtn" TargetType="Button" BasedOn="{StaticResource PrimaryBtn}">
                <Setter Property="BackgroundColor" Value="#27AE60" />
            </Style>
            <Style x:Key="SectionTitle" TargetType="Label">
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="#1F2937" />
                <Setter Property="Margin" Value="0,5,0,4" />
            </Style>
            <Style x:Key="FieldLabel" TargetType="Label">
                <Setter Property="TextColor" Value="#4B5563" />
                <Setter Property="VerticalTextAlignment" Value="Center" />
                <Setter Property="HorizontalOptions" Value="Start" />
                <Setter Property="HorizontalTextAlignment" Value="Start" />
                <Setter Property="Padding" Value="0" />
            </Style>
            <Style x:Key="FieldValue" TargetType="Label">
                <Setter Property="TextColor" Value="#111827" />
                <Setter Property="VerticalTextAlignment" Value="Center" />
                <Setter Property="HorizontalOptions" Value="Start" />
                <Setter Property="HorizontalTextAlignment" Value="Start" />
            </Style>
            <Style x:Key="Card" TargetType="Frame">
                <Setter Property="Padding" Value="12" />
                <Setter Property="CornerRadius" Value="8" />
                <Setter Property="HasShadow" Value="False" />
                <Setter Property="BorderColor" Value="#E5E7EB" />
            </Style>
            <!-- åªè¯»å±•ç¤ºå°ç°æ¡† -->
            <Style x:Key="ReadonlyPill" TargetType="Frame">
                <Setter Property="Padding" Value="8,6" />
                <Setter Property="CornerRadius" Value="6" />
                <Setter Property="HasShadow" Value="False" />
                <Setter Property="BackgroundColor" Value="#F3F4F6" />
                <Setter Property="BorderColor" Value="#E5E7EB" />
            </Style>
            <Style TargetType="Entry">
                <Setter Property="HorizontalOptions" Value="Fill" />
                <Setter Property="Margin" Value="0" />
                <Setter Property="HeightRequest" Value="42" />
                <Setter Property="VerticalOptions" Value="Center" />
                <Setter Property="BackgroundColor" Value="Transparent" />
                <Setter Property="HorizontalTextAlignment" Value="Start" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>


    <Grid x:Name="RootGrid">

        <!-- ç‚¹å‡»ç©ºç™½å¤„æ”¶èµ·æ£€éªŒå‘˜ä¸‹æ‹‰ -->
        <Grid.GestureRecognizers>
            <TapGestureRecognizer Command="{Binding ClearInspectorCommand}" />
        </Grid.GestureRecognizers>

        <ScrollView>
            <VerticalStackLayout Spacing="8" Padding="12">
                <Grid Grid.Row="0"  HeightRequest="56" Padding="12" ColumnDefinitions="*,Auto,Auto" ColumnSpacing="8">
                    <Label Text="ç‚¹å·¡æ£€å•åŸºç¡€ä¿¡æ¯"
                   VerticalOptions="Start"
                   TextColor="Black"
                   FontSize="14"
                   FontAttributes="Bold" />
                    <Button Grid.Column="1"
                    Text="ä¿å­˜"
                    Style="{StaticResource PrimaryBtn}"
                    Command="{Binding SaveCommand}"
                    IsVisible="{Binding IsEditing}"/>
                    <Button Grid.Column="2"
                    Text="å®Œæˆç‚¹æ£€"
                    Style="{StaticResource SuccessBtn}"
                    Command="{Binding CompleteCommand}"
                    IsVisible="{Binding IsEditing}"/>
                </Grid>

                <Frame Style="{StaticResource Card}">
                    <Grid ColumnDefinitions="80,*,80,*"
                          RowDefinitions="Auto,Auto,Auto,Auto" RowSpacing="8" ColumnSpacing="5"
                          >

                        <!-- ç¬¬ä¸€è¡Œ -->
                        <Label Grid.Row="0" Grid.Column="0" Text="ç‚¹æ£€å•å·ï¼š" Style="{StaticResource FieldLabel}" />
                        <Label Grid.Row="0" Grid.Column="1" Text="{Binding Detail.inspectNo}" Style="{StaticResource FieldValue}" />

                        <Label Grid.Row="0" Grid.Column="2" Text="è®¡åˆ’åç§°ï¼š" Style="{StaticResource FieldLabel}" />
                        <Label Grid.Row="0" Grid.Column="3" Text="{Binding Detail.planName}" Style="{StaticResource FieldValue}" />

                        <!-- ç¬¬äºŒè¡Œ -->
                        <Label Grid.Row="1" Grid.Column="0" Text="è®¡åˆ’ç¼–å·ï¼š" Style="{StaticResource FieldLabel}" />
                        <Label Grid.Row="1" Grid.Column="1" Text="{Binding Detail.planCode}" Style="{StaticResource FieldValue}" />
                        <Label Grid.Row="1" Grid.Column="2" Text="è®¾å¤‡åç§°ï¼š" Style="{StaticResource FieldLabel}" />
                        <Label Grid.Row="1" Grid.Column="3" Text="{Binding Detail.devName}" Style="{StaticResource FieldValue}" />
                        <Label Grid.Row="2" Grid.Column="0" Text="è®¾å¤‡ç¼–å·ï¼š" Style="{StaticResource FieldLabel}" />
                        <Label Grid.Row="2" Grid.Column="1" Text="{Binding Detail.devCode}" Style="{StaticResource FieldValue}" />
                        <Label Grid.Row="2" Grid.Column="2" Text="è®¡åˆ’ç‚¹æ£€æ—¥æœŸï¼š" Style="{StaticResource FieldLabel}" />
                        <Label Grid.Row="2" Grid.Column="3" Text="{Binding Detail.planInspectTime}" Style="{StaticResource FieldValue}" />

                        <!-- ç¬¬ä¸‰è¡Œ -->
                        <Label Grid.Row="3" Grid.Column="0" Text="å¤‡æ³¨ï¼š" Style="{StaticResource FieldLabel}" />
                        <Label Grid.Row="3" Grid.Column="1" Grid.ColumnSpan="3" Text="{Binding Detail.memo}" Style="{StaticResource FieldValue}" />

                    </Grid>
                </Frame>
                <!-- æ£€éªŒç»“æžœ -->
            <Label Text="æ£€éªŒç»“æžœ" Style="{StaticResource SectionTitle}"/>
            <Frame Style="{StaticResource Card}">
                    <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto"
       ColumnDefinitions="90,*,60,*,60,*" 
        RowSpacing="8" ColumnSpacing="5">

                        <Label Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Text="æ£€éªŒç»“æžœï¼š" />

                        <!-- è¿™é‡Œæ”¹ï¼šç”¨å­—ç¬¦ä¸²åˆ—è¡¨ + è‡ªå·±çš„ SelectedItem åšè§¦å‘ -->
                        <Picker x:Name="MainResultPicker"
        Grid.Row="0" Grid.Column="2" Grid.ColumnSpan="2"
        ItemsSource="{Binding InspectResultTextList}"
        SelectedItem="{Binding Detail.inspectResult, Mode=TwoWay}"
        IsEnabled="{Binding IsEditing}">

                            <Picker.BackgroundColor>#F3F4F6</Picker.BackgroundColor>

                            <Picker.Triggers>
                                <DataTrigger TargetType="Picker"
                     Binding="{Binding Source={x:Reference MainResultPicker}, Path=SelectedItem}"
                     Value="åˆæ ¼">
                                    <Setter Property="BackgroundColor" Value="#B2F2BB"/>
                                </DataTrigger>

                                <DataTrigger TargetType="Picker"
                     Binding="{Binding Source={x:Reference MainResultPicker}, Path=SelectedItem}"
                     Value="ä¸åˆæ ¼">
                                    <Setter Property="BackgroundColor" Value="#FFA8A8"/>
                                </DataTrigger>
                            </Picker.Triggers>

                        </Picker>

                        <!-- åˆ†å‰²çº¿ -->
                        <BoxView Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="6" HeightRequest="1" BackgroundColor="#E5E7EB" />
                        <Label Grid.Row="2" Grid.Column="0" Text="ç‚¹æ£€é¡¹ç›®æ€»æ•°ï¼š" Style="{StaticResource FieldLabel}" />
                        <Label Grid.Row="2" Grid.Column="1"  Text="{Binding Detail.inspectNum}"/>

                        <Label Grid.Row="2" Grid.Column="2" Text="åˆæ ¼é¡¹ç›®æ•°ï¼š" Style="{StaticResource FieldLabel}" />
                        <Label Grid.Row="2" Grid.Column="3"
        Text="{Binding Detail.qualifiedNum}"
         />
                        <Label Grid.Row="2" Grid.Column="4" Text="ä¸åˆæ ¼é¡¹ç›®æ•°ï¼š" Style="{StaticResource FieldLabel}" />
                        <Label Grid.Row="2" Grid.Column="5"
         Text="{Binding Detail.unqualifiedNum}"
         />
                        <Label Grid.Row="3" Grid.Column="0" Text="å®žé™…ç‚¹æ£€æ—¥æœŸï¼š" Style="{StaticResource FieldLabel}" />
                        <Label Grid.Row="3" Grid.Column="1" 
       Text="{Binding Detail.inspectTime}"
       />

                        <Label Grid.Row="3" Grid.Column="2"  Text="æ“ä½œäººï¼š" Style="{StaticResource FieldLabel}" />
                        <Grid Grid.Row="3" Grid.Column="3" Grid.ColumnSpan="2">
                            <Entry x:Name="InspectorEntry"
           Text="{Binding InspectorText, Mode=TwoWay}"
           Placeholder="è¯·è¾“å…¥"
           Completed="OnInspectorEntryCompleted"/>
                            <!-- ä¸‹æ‹‰æµ®å±‚ -->
                            <Frame HasShadow="True" Padding="0" Margin="0,40,0,0"
           IsVisible="{Binding IsInspectorDropdownOpen}"
           ZIndex="9999" CornerRadius="8"
           BackgroundColor="White" BorderColor="#E5E7EB">
                                <CollectionView ItemsSource="{Binding InspectorSuggestions}" HeightRequest="220">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate>
                                            <Grid Padding="10" ColumnDefinitions="Auto,*">
                                                <Label Grid.Column="0" Text="ðŸ‘¤"/>
                                                <Label Grid.Column="1" Text="{Binding realname}"/>
                                                <Grid.GestureRecognizers>
                                                    <TapGestureRecognizer
                                Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.PickInspectorCommand}"
                                CommandParameter="{Binding .}"/>
                                                </Grid.GestureRecognizers>
                                            </Grid>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                            </Frame>
                        </Grid>

                        <!-- ç¬¬4è¡Œï¼šæ£€éªŒå¤‡æ³¨ï¼ˆæ•´è¡Œï¼‰ -->
                        <Label Grid.Row="4" Grid.Column="0" Text="ç‚¹æ£€å¤‡æ³¨ï¼š" Style="{StaticResource FieldLabel}" />
                        <Entry  Grid.Row="4" Grid.Column="1" Grid.ColumnSpan="5"
        Text="{Binding Detail.inspectMemo, Mode=TwoWay}"
        IsEnabled="{Binding IsEditing}" />



                    </Grid>
            </Frame>
                <Grid ColumnDefinitions="*,120">
                    <!-- ç‚¹æ£€é¡¹ç›®æ‰§è¡Œ -->
            <Label Text="ç‚¹æ£€é¡¹ç›®æ‰§è¡Œ" Style="{StaticResource SectionTitle}"/>
                    <Button Grid.Column="1"
 Text="ä¸€é”®åˆæ ¼"
 Style="{StaticResource PrimaryBtn}"
 Command="{Binding SetAllInspectionCommand}"
 IsVisible="{Binding IsEditing}"/>
                </Grid>
                <CollectionView ItemsSource="{Binding Items}" SelectionMode="None">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <!-- å·¦ä¾§åºå· + å³ä¾§åŽŸå¡ç‰‡ -->
                            <Grid ColumnDefinitions="12,*" ColumnSpacing="8" Margin="0,6,0,0">
                                <!-- åºå·ï¼šä¸Žå¡ç‰‡é¡¶éƒ¨å¯¹é½ -->
                                <Label Grid.Column="0"
       Text="{Binding index}"
       VerticalOptions="Center"
       HorizontalTextAlignment="Center"
       VerticalTextAlignment="Center"
       FontAttributes="Bold"
       TextColor="#111827"
       Margin="0,8,0,0"/>

                                <!-- å³ä¾§ä½ çš„åŽŸ Frame å¡ç‰‡ï¼Œå†…å®¹ä¿æŒä¸å˜ -->
                                <Frame Grid.Column="1" Style="{StaticResource Card}">
                                    <Grid
        RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto"
        ColumnDefinitions="Auto,*"
        RowSpacing="8" ColumnSpacing="5">

                                        <!-- è¡Œ0ï¼šé¡¹ç›®åç§° -->
                                        <Label Grid.Row="0" Grid.Column="0" Text="é¡¹ç›®åç§°ï¼š" Style="{StaticResource FieldLabel}" />
                                        <Label Grid.Row="0" Grid.Column="1" Text="{Binding itemName}" Style="{StaticResource FieldValue}" />
                                        <BoxView Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="6" HeightRequest="1" BackgroundColor="#E5E7EB" />
                                        <!-- è¡Œ1ï¼šæ£€éªŒå±žæ€§ã€æ£€éªŒæ–¹å¼ -->
                                        <Grid Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
              ColumnDefinitions="Auto,*,Auto,*" ColumnSpacing="10">
                                            <Label Grid.Column="0" Text="æ£€éªŒå±žæ€§ï¼š" Style="{StaticResource FieldLabel}" />
                                            <Label Grid.Column="1" Text="{Binding inspectionAttributeName}" Style="{StaticResource FieldValue}" />
                                            <Label Grid.Column="2" Text="æ£€éªŒæ–¹å¼ï¼š" Style="{StaticResource FieldLabel}" />
                                            <Label Grid.Column="3" Text="{Binding inspectionMode}" Style="{StaticResource FieldValue}" />
                                        </Grid>
                                        <Grid Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2" ColumnDefinitions="Auto,*" ColumnSpacing="10">
                                            <Label Grid.Column="0" Text="æ£€éªŒæ ‡å‡†ï¼š" Style="{StaticResource FieldLabel}" />
                                            <Label Grid.Column="1" Text="{Binding inspectionStandard}" Style="{StaticResource FieldValue}" />
                                        </Grid>
                                        <!-- è¡Œ2ï¼šæ ‡å‡†å€¼ã€ä¸Šé™å€¼ã€ä¸‹é™å€¼ -->
                                        <Grid Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="2"
              ColumnDefinitions="Auto,*,Auto,*,Auto,*" ColumnSpacing="10">
                                            <Label Grid.Column="0" Text="æ ‡å‡†å€¼ï¼š" Style="{StaticResource FieldLabel}" />
                                            <Label Grid.Column="1" Text="{Binding standardValue}" Style="{StaticResource FieldValue}" />
                                            <Label Grid.Column="2" Text="ä¸Šé™å€¼ï¼š" Style="{StaticResource FieldLabel}" />
                                            <Label Grid.Column="3" Text="{Binding upperLimit}" Style="{StaticResource FieldValue}" />
                                            <Label Grid.Column="4" Text="ä¸‹é™å€¼ï¼š" Style="{StaticResource FieldLabel}" />
                                            <Label Grid.Column="5" Text="{Binding lowerLimit}" Style="{StaticResource FieldValue}" />
                                        </Grid>

                                        <!-- è¡Œ4ï¼šæŠ½æ ·æ•°ã€ä¸è‰¯æ•°ã€ä¸è‰¯çŽ‡(åªè¯») -->
                                        <Grid Grid.Row="5" Grid.Column="0" Grid.ColumnSpan="2"
                                ColumnDefinitions="Auto,*,Auto,*,Auto,*" ColumnSpacing="10">
                                            <Label Grid.Column="0" Text="ç‚¹æ£€å€¼ï¼š" Style="{StaticResource FieldLabel}" />
                                            <Entry Grid.Column="1" Text="{Binding inspectValue, Mode=TwoWay, Converter={StaticResource DecConv}}" Keyboard="Numeric"
IsEnabled="{Binding Source={x:Reference ThisPage}, Path=BindingContext.IsEditing}" />
                                            <Label Grid.Column="2" Text="å•ä½ï¼š" Style="{StaticResource FieldLabel}" />
                                            <Label Grid.Column="3" Text="{Binding unit}"  />
                                            
                                        </Grid>

                                        <Grid Grid.Row="6" Grid.Column="0" Grid.ColumnSpan="2"
ColumnDefinitions="Auto,*" ColumnSpacing="10">
                                            <Label Text="ç‚¹æ£€ç»“æžœï¼š" Style="{StaticResource FieldLabel}" />

                                            <Picker x:Name="RowResultPicker"
        Grid.Column="1"
        ItemsSource="{Binding BindingContext.InspectResultTextList,
                              Source={RelativeSource AncestorType={x:Type ContentPage}}}"
        SelectedItem="{Binding inspectResult, Mode=TwoWay}"
        IsEnabled="{Binding BindingContext.IsEditing,
                            Source={RelativeSource AncestorType={x:Type ContentPage}}}">
                                                <!-- é»˜è®¤åº•è‰² -->
                                                <Picker.BackgroundColor>#F3F4F6</Picker.BackgroundColor>

                                                <Picker.Triggers>
                                                    <!-- ç›´æŽ¥ç›‘å¬æŽ§ä»¶è‡ªå·±çš„ SelectedItem -->
                                                    <DataTrigger TargetType="Picker"
                     Binding="{Binding Source={x:Reference RowResultPicker}, Path=SelectedItem}"
                     Value="åˆæ ¼">
                                                        <Setter Property="BackgroundColor" Value="#B2F2BB" />
                                                    </DataTrigger>

                                                    <DataTrigger TargetType="Picker"
                     Binding="{Binding Source={x:Reference RowResultPicker}, Path=SelectedItem}"
                     Value="ä¸åˆæ ¼">
                                                        <Setter Property="BackgroundColor" Value="#FFA8A8" />
                                                    </DataTrigger>
                                                </Picker.Triggers>
                                            </Picker>

                                        </Grid>
                                        <Grid Grid.Row="7" Grid.Column="0" Grid.ColumnSpan="2"
                                ColumnDefinitions="Auto,*" ColumnSpacing="10">
                                            <Label Grid.Column="0" Text="å¤‡æ³¨ï¼š" Style="{StaticResource FieldLabel}" />
                                            <Entry Grid.Row="5" Grid.Column="1" Grid.ColumnSpan="5"
       Text="{Binding memo, Mode=TwoWay}"
       IsEnabled="{Binding IsEditing}" />
                                        </Grid>
                                    </Grid>
                                </Frame>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <!-- å›¾ç‰‡é™„ä»¶ -->
                <Label Text="å›¾ç‰‡é™„ä»¶" Style="{StaticResource SectionTitle}" HorizontalOptions="Start" />
                <!-- å·¦çª„å³å®½ä¸¤åˆ— -->
                <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto" ColumnDefinitions="40,*" RowSpacing="8">

                    <!-- Row0 å·¦ï¼šå›¾ç‰‡ä¸Šä¼ æ ‡é¢˜ -->
                    <Label Grid.Row="0" Grid.Column="0" Text="å›¾ç‰‡ä¸Šä¼ ï¼š" VerticalTextAlignment="Start" />

                    <!-- Row0 å³ï¼šç¼©ç•¥å›¾ + ä¸Šä¼ æ–¹å— -->
                    <HorizontalStackLayout Grid.Row="0" Grid.Column="1" Spacing="8" VerticalOptions="Start">

                        <CollectionView ItemsSource="{Binding ImageAttachments}"
                    ItemsLayout="HorizontalList"
                    HeightRequest="96"
                    SelectionMode="None">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Grid>
                                        <Frame Padding="0" WidthRequest="96" HeightRequest="96"
                   CornerRadius="8" HasShadow="False" BorderColor="#E5E7EB" Margin="0,0,8,0">
                                            <Image Aspect="AspectFill" Source="{Binding DisplaySource}" />
                                        </Frame>
                                        <!-- å³ä¸Šè§’åˆ é™¤ -->
                                        <Button Text="Ã—" FontSize="12" Padding="0"
                                                WidthRequest="22" HeightRequest="22" CornerRadius="11"
                                                BackgroundColor="#00000066" TextColor="White"
                                                HorizontalOptions="End" VerticalOptions="Start" Margin="2"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteAttachmentCommand}"
                                                CommandParameter="{Binding .}"
                                                IsVisible="{Binding IsEditing}" />
                                    </Grid>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>

                        <!-- ä¸Šä¼ æ–¹å— -->
                        <Frame WidthRequest="96" HeightRequest="96" CornerRadius="8"
           BorderColor="#E5E7EB" BackgroundColor="White" IsVisible="{Binding IsEditing}"
           HasShadow="False" Padding="8" VerticalOptions="Start">
                            <VerticalStackLayout Spacing="4" VerticalOptions="Center" HorizontalOptions="Center">
                                <Label Text="ï¼‹" FontSize="28" TextColor="#9CA3AF" />
                                <Label Text="å•å‡»ä¸Šä¼ " FontSize="12" TextColor="#9CA3AF" Margin="0,0,0,2" LineHeight="1.1"/>
                            </VerticalStackLayout>
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer  Tapped="OnPickImagesClicked" />
                            </Frame.GestureRecognizers>
                        </Frame>
                    </HorizontalStackLayout>

                    <!-- Row1 å·¦ï¼šé™„ä»¶ä¿¡æ¯æ ‡é¢˜ -->
                    <Label Grid.Row="1" Grid.Column="0" Text="é™„ä»¶ä¿¡æ¯ï¼š" VerticalTextAlignment="Center" />

                    <!-- Row1 å³ï¼šä¸Šä¼ é™„ä»¶é“¾æŽ¥ -->
                    <HorizontalStackLayout Grid.Row="1" Grid.Column="1" Spacing="12" VerticalOptions="Center" IsVisible="{Binding IsEditing}">
                        <Label Text="ä¸Šä¼ é™„ä»¶" TextColor="#3B82F6">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnPickFileClicked" />
                            </Label.GestureRecognizers>
                        </Label>
                    </HorizontalStackLayout>

                    <!-- Row2 å³ï¼šæç¤º -->
                    <Label Grid.Row="2" Grid.Column="1"
         Text="ï¼ˆå•ä¸ªé™„ä»¶æœ€å¤§æ”¯æŒ20Mï¼Œæ”¯æŒæ ¼å¼PDFã€Wordã€Excelã€Txtã€JPGã€PNGã€RARï¼‰"
         FontSize="12" TextColor="#9CA3AF" IsVisible="{Binding IsEditing}"/>

                    <!-- Row3 å³ï¼šé™„ä»¶è¡¨æ ¼ -->
                    <Grid Grid.Row="3" Grid.Column="1" RowDefinitions="Auto,*" Margin="0,4,0,0">
                        <Grid Grid.Row="0" ColumnDefinitions="40,100,40,80,120"
          BackgroundColor="#E5EEF9" Padding="8,8">
                            <Label Grid.Column="0" Text="åºå·" />
                            <Label Grid.Column="1" Text="é™„ä»¶åç§°" />
                            <Label Grid.Column="2" Text="å¤§å°" />
                            <Label Grid.Column="3" Text="ä¸Šä¼ æ—¶é—´" />
                            <Label Grid.Column="4" Text="æ“ä½œ" />
                        </Grid>

                        <CollectionView x:Name="AttList" Grid.Row="1" ItemsSource="{Binding Attachments}" SelectionMode="None">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Grid ColumnDefinitions="40,100,40,80,120" Padding="8,10">
                                        <Label Text="{Binding .,
                                            Converter={StaticResource IndexConverter},
                                            ConverterParameter={x:Reference AttList}}" />
                                        <Label Grid.Column="1" Text="{Binding AttachmentName}" LineBreakMode="TailTruncation"/>
                                        <Label Grid.Column="2" Text="{Binding AttachmentSize}" />
                                        <Label Grid.Column="3" Text="{Binding CreatedTime}" />
                                        <HorizontalStackLayout Grid.Column="4" Spacing="16">
                                            <Label Text="ä¸‹è½½" TextColor="#3B82F6">
                                                <Label.GestureRecognizers>
                                                    <TapGestureRecognizer
                    Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DownloadAttachmentCommand}"
                    CommandParameter="{Binding .}" />
                                                </Label.GestureRecognizers>
                                            </Label>
                                            <Label Text="åˆ é™¤" TextColor="Red" IsVisible="{Binding IsEditing}">
                                                <Label.GestureRecognizers>
                                                    <TapGestureRecognizer
                    Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteAttachmentCommand}"
                    CommandParameter="{Binding .}" />
                                                </Label.GestureRecognizers>
                                            </Label>
                                        </HorizontalStackLayout>
                                    </Grid>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>

                    </Grid>
                    <Grid Grid.Row="4"  Grid.Column="0" Grid.ColumnSpan="2" RowDefinitions="Auto,*">
                        <Grid Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2"
ColumnDefinitions="Auto,*,Auto,*" ColumnSpacing="10">
                            <Label Grid.Column="0" Text="åˆ›å»ºäººï¼š" Style="{StaticResource FieldLabel}" />
                            <Label Grid.Column="1" Text="{Binding Detail.creator}" Style="{StaticResource FieldValue}" />
                            <Label Grid.Column="2" Text="åˆ›å»ºæ—¥æœŸï¼š" Style="{StaticResource FieldLabel}" />
                            <Label Grid.Column="3" Text="{Binding Detail.createdTime}" Style="{StaticResource FieldValue}" />
                        </Grid>
                        <Grid Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
ColumnDefinitions="Auto,*,Auto,*" ColumnSpacing="10">
                            <Label Grid.Column="0" Text="æœ€è¿‘ä¿®æ”¹äººï¼š" Style="{StaticResource FieldLabel}" />
                            <Label Grid.Column="1" Text="{Binding Detail.modifier}" Style="{StaticResource FieldValue}" />
                            <Label Grid.Column="2" Text="ä¿®æ”¹æ—¥æœŸï¼š" Style="{StaticResource FieldLabel}" />
                            <Label Grid.Column="3" Text="{Binding Detail.modifiedTime}" Style="{StaticResource FieldValue}" />
                        </Grid>
                    </Grid>
                </Grid>


            </VerticalStackLayout>
    </ScrollView>
    </Grid>
</ContentPage>
