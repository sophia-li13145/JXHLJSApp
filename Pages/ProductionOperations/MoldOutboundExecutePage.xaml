<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="JXHLJSApp.Pages.MoldOutboundExecutePage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:conv="clr-namespace:JXHLJSApp.Converters"
    Shell.NavBarIsVisible="True">
    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- è½¬æ¢å™¨ -->
            <conv:InverseBoolConverter x:Key="InverseBoolConverter" />
            <conv:BoolToPrimaryOrGrayConverter x:Key="BoolToPrimaryOrGray" />
            <!-- é¢œè‰² -->
            <Color x:Key="ClrBlue">#3F88F7</Color>
            <Color x:Key="ClrGreen">#4CAF50</Color>
            <Color x:Key="ClrGray">#BFC6D4</Color>
            <Color x:Key="ClrLine">#FFFFFF</Color>
            <Color x:Key="ClrTextSub">#718096</Color>
            <Color x:Key="ClrTextMain">#111111</Color>
            <!-- å¡ç‰‡æ ·å¼ -->
            <Style TargetType="Frame" x:Key="Card">
                <Setter Property="HasShadow" Value="False" />
                <Setter Property="BorderColor" Value="#E5EAF2" />
                <Setter Property="Padding" Value="12" />
                <Setter Property="Margin" Value="0,10,0,0" />
            </Style>

            <Style TargetType="Label" x:Key="SectionTitle">
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="FontSize" Value="16" />
                <Setter Property="TextColor" Value="#1F2D3D" />
                <Setter Property="Margin" Value="0,0,0,8" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <Grid Padding="14" RowDefinitions="Auto,Auto,Auto,*,Auto">

            <VerticalStackLayout Spacing="10">

                <Label Grid.Column="1"
                   Text="å·¥å•åŸºç¡€ä¿¡æ¯"
                   Style="{StaticResource SectionTitle}"
                   Margin="6,0,0,0" />

                <CollectionView ItemsSource="{Binding WorkflowSteps}" SelectionMode="None">
                    <!-- ä¸€è¡Œ 3 ä¸ªï¼Œè‡ªåŠ¨æ¢è¡Œä¸ºä¸¤æŽ’ -->
                    <CollectionView.ItemsLayout>
                        <GridItemsLayout Orientation="Vertical" Span="3" />
                    </CollectionView.ItemsLayout>

                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <!-- æ¯ä¸ªèŠ‚ç‚¹ï¼šä¸Šè¡Œ åœ†åœˆ+æ ‡é¢˜+è¿žçº¿ï¼Œä¸‹è¡Œ æ—¥æœŸ -->
                            <Grid RowDefinitions="Auto,Auto"
                  ColumnDefinitions="Auto,Auto,20"
                  Margin="0,0,8,0">

                                <!-- åœ†åœˆ -->
                                <Grid Grid.Row="0"
                      Grid.Column="0"
                      WidthRequest="26"
                      HeightRequest="26"
                      VerticalOptions="Center">

                                    <Ellipse Stroke="#D8D8D8"
                             StrokeThickness="2"
                             Fill="White">
                                        <Ellipse.Triggers>
                                            <!-- å·²å®Œæˆï¼šç™½åº•è“æè¾¹ -->
                                            <DataTrigger TargetType="Ellipse"
                                         Binding="{Binding IsDone}"
                                         Value="True">
                                                <Setter Property="Stroke" Value="#3F88F7" />
                                                <Setter Property="Fill"   Value="White" />
                                            </DataTrigger>
                                            <!-- å½“å‰æ­¥éª¤ï¼šè“è‰²å®žå¿ƒ -->
                                            <DataTrigger TargetType="Ellipse"
                                         Binding="{Binding IsActive}"
                                         Value="True">
                                                <Setter Property="Stroke" Value="#3F88F7" />
                                                <Setter Property="Fill"   Value="#3F88F7" />
                                            </DataTrigger>
                                        </Ellipse.Triggers>
                                    </Ellipse>

                                    <!-- åœ†å†…éƒ¨æ–‡å­—ï¼šâœ” æˆ–æ•°å­— -->
                                    <Label HorizontalOptions="Center"
                           VerticalOptions="Center"
                           FontSize="12"
                           Text="{Binding Index}"
                           TextColor="#C0C4CC">
                                        <Label.Triggers>
                                            <!-- å·²å®Œæˆï¼šè“è‰²å¯¹å· -->
                                            <DataTrigger TargetType="Label"
                                         Binding="{Binding IsDone}"
                                         Value="True">
                                                <Setter Property="Text" Value="âœ”" />
                                                <Setter Property="TextColor" Value="#3F88F7" />
                                                <Setter Property="FontAttributes" Value="Bold" />
                                            </DataTrigger>
                                            <!-- å½“å‰æ­¥éª¤ï¼šç™½è‰²æ•°å­— -->
                                            <DataTrigger TargetType="Label"
                                         Binding="{Binding IsActive}"
                                         Value="True">
                                                <Setter Property="TextColor" Value="White" />
                                                <Setter Property="FontAttributes" Value="Bold" />
                                            </DataTrigger>
                                        </Label.Triggers>
                                    </Label>
                                </Grid>

                                <!-- æ ‡é¢˜ -->
                                <Label Grid.Row="0"
                       Grid.Column="1"
                       Margin="6,0,0,0"
                       VerticalTextAlignment="Center"
                       FontSize="13"
                       Text="{Binding Title}"
                       TextColor="#C0C4CC">
                                    <Label.Triggers>
                                        <!-- å·²å®Œæˆï¼šè“è‰² -->
                                        <DataTrigger TargetType="Label"
                                     Binding="{Binding IsDone}"
                                     Value="True">
                                            <Setter Property="TextColor" Value="#3F88F7" />
                                        </DataTrigger>
                                        <!-- å½“å‰ï¼šè“è‰²åŠ ç²— -->
                                        <DataTrigger TargetType="Label"
                                     Binding="{Binding IsActive}"
                                     Value="True">
                                            <Setter Property="TextColor" Value="#3F88F7" />
                                            <Setter Property="FontAttributes" Value="Bold" />
                                        </DataTrigger>
                                    </Label.Triggers>
                                </Label>

                                <!-- è¿žçº¿ï¼šæœ‰çš„ç»“ç‚¹ï¼ˆå·²å®Œæˆæˆ–å½“å‰ï¼‰è“è‰²ï¼Œæ²¡æœ‰çš„ç»“ç‚¹ç°è‰²ï¼›æ¯è¡Œæœ€åŽä¸€ä¸ªéšè— -->
                                <BoxView Grid.Row="0"
                         Grid.Column="2"
                         WidthRequest="20"
                         HeightRequest="2"
                         VerticalOptions="Center"
                         HorizontalOptions="End"
                         Color="#D8D8D8">
                                    <BoxView.Triggers>
                                        <!-- æ¯è¡Œç»“å°¾ï¼ˆIsLast=trueï¼‰éšè—è¿žçº¿ -->
                                        <DataTrigger TargetType="BoxView"
                                     Binding="{Binding IsLast}"
                                     Value="True">
                                            <Setter Property="IsVisible" Value="False" />
                                        </DataTrigger>

                                        <!-- å·²å®Œæˆï¼šè“çº¿ -->
                                        <DataTrigger TargetType="BoxView"
                                     Binding="{Binding IsDone}"
                                     Value="True">
                                            <Setter Property="Color" Value="#3F88F7" />
                                        </DataTrigger>

                                        <!-- å½“å‰æ­¥éª¤ï¼šè“çº¿ -->
                                        <DataTrigger TargetType="BoxView"
                                     Binding="{Binding IsActive}"
                                     Value="True">
                                            <Setter Property="Color" Value="#3F88F7" />
                                        </DataTrigger>
                                    </BoxView.Triggers>
                                </BoxView>

                                <!-- æ—¥æœŸ -->
                                <Label Grid.Row="1"
                       Grid.ColumnSpan="3"
                       Margin="0,4,0,0"
                       FontSize="11"
                       HorizontalTextAlignment="Center"
                       Text="{Binding TimeText}"
                       TextColor="#A0A4AB" />
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>

            <!-- å·¥å•åŸºç¡€ä¿¡æ¯è¡¨æ ¼ï¼ˆå›ºå®šå­—æ®µï¼‰ -->
            <Frame Grid.Row="1" Style="{StaticResource Card}">
                <Grid ColumnDefinitions="80,100,80,80"
        RowDefinitions="Auto,Auto,Auto,Auto,Auto"
        RowSpacing="6" ColumnSpacing="8">

                    <!-- ç¬¬1è¡Œ -->
                    <Label Grid.Row="0" Grid.Column="0" Text="å·¥å•ç¼–å·ï¼š" FontAttributes="Bold"/>
                    <Label Grid.Row="0" Grid.Column="1" Text="{Binding OrderNo}" />

                    <Label Grid.Row="0" Grid.Column="2" Text="çŠ¶æ€ï¼š" FontAttributes="Bold"/>
                    <Label Grid.Row="0" Grid.Column="3" Text="{Binding StatusText}"/>

                    <!-- ç¬¬2è¡Œ -->
                    <Label Grid.Row="1" Grid.Column="0" Text="å·¥å•åç§°ï¼š" FontAttributes="Bold"/>
                    <Label Grid.Row="1" Grid.Column="1" Text="{Binding OrderName}" />

                    <Label Grid.Row="1" Grid.Column="2" Text="ä¼˜å…ˆçº§ï¼š" FontAttributes="Bold"/>
                    <Label Grid.Row="1" Grid.Column="3" Text="{Binding Urgent}" />

                    <!-- ç¬¬3è¡Œ -->
                    <Label Grid.Row="2" Grid.Column="0" Text="äº§å“åç§°ï¼š" FontAttributes="Bold"/>
                    <Label Grid.Row="2" Grid.Column="1" Text="{Binding ProductName}" />

                    <Label Grid.Row="2" Grid.Column="2" Text="ç”Ÿäº§æ•°é‡ï¼š" FontAttributes="Bold"/>
                    <Label Grid.Row="2" Grid.Column="3" Text="{Binding PlanQtyText}" />

                    <!-- ç¬¬4è¡Œ -->
                    <Label Grid.Row="3" Grid.Column="0" Text="è®¡åˆ’å¼€å§‹æ—¥æœŸï¼š" FontAttributes="Bold"/>
                    <Label Grid.Row="3" Grid.Column="1" Text="{Binding PlanStartText}" />

                    <Label Grid.Row="3" Grid.Column="2" Text="åˆ›å»ºæ—¥æœŸï¼š" FontAttributes="Bold"/>
                    <Label Grid.Row="3" Grid.Column="3" Text="{Binding CreateDateText}" />

                    <!-- ç¬¬5è¡Œ -->
                    <Label Grid.Row="4" Grid.Column="0" Text="BOMç¼–å·ï¼š" FontAttributes="Bold"/>
                    <Label Grid.Row="4" Grid.Column="1" Text="{Binding BomCode}"/>

                    <Label Grid.Row="4" Grid.Column="2" Text="å·¥è‰ºè·¯çº¿åç§°ï¼š" FontAttributes="Bold"/>
                    <Label Grid.Row="4" Grid.Column="3" Text="{Binding RouteName}"/>

                </Grid>
            </Frame>


            <!-- å·¥åºä»»åŠ¡è¿›åº¦ï¼ˆç«–å‘æ—¶é—´è½´ï¼‰ -->
            <Frame Grid.Row="3" Style="{StaticResource Card}">
                <VerticalStackLayout Spacing="8">
                    <Label Text="å·¥åºä»»åŠ¡è¿›åº¦" Style="{StaticResource SectionTitle}" />

                    <CollectionView ItemsSource="{Binding ProcessTasks}" SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <!-- å·¦ 40ï¼šåœ†ç‚¹ + ç«–çº¿ï¼›å³ï¼šåç§° + æ—¶é—´ + çŠ¶æ€ -->
                                <Grid ColumnDefinitions="40,*" Padding="0,8">

                                    <!-- å·¦ä¾§ï¼šåœ†ç‚¹ + ç«–çº¿ -->
                                    <Grid RowDefinitions="Auto,Auto" WidthRequest="40">
                                        <!-- åœ†åœˆ -->
                                        <Grid WidthRequest="26" HeightRequest="26" HorizontalOptions="Center">
                                            <!-- å¤–åœˆæè¾¹ -->
                                            <Ellipse x:Name="dotBorder"
                                         Stroke="{StaticResource ClrLine}"
                                         StrokeThickness="3"
                                         Fill="White" />
                                            <!-- åœ†å†…æ–‡å­—ï¼šé»˜è®¤æ˜¾ç¤ºåºå· -->
                                            <Label x:Name="dotText"
                                       Text="{Binding Index}"
                                       FontSize="12"
                                       TextColor="#C0C4CC"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"/>
                                        </Grid>

                                        <!-- ç«–çº¿ -->
                                        
                                        <BoxView x:Name="dotLine"
                                                 Grid.Row="1"
                                                 WidthRequest="2"
                                                 HorizontalOptions="Center"
                                                 Color="{StaticResource ClrLine}"
                                                 HeightRequest="36">

                                            <BoxView.Triggers>
                                                <!-- æœ€åŽä¸€ä¸ªèŠ‚ç‚¹ï¼šéšè—ä¸‹é¢çš„ç«–çº¿ -->
                                                <DataTrigger TargetType="BoxView"
                                                             Binding="{Binding IsLast}"
                                                             Value="True">
                                                    <Setter Property="IsVisible" Value="False" />
                                                </DataTrigger>
                                            </BoxView.Triggers>
                                        </BoxView>
                                    </Grid>

                                    <!-- å³ä¾§å†…å®¹ -->
                                    <Grid Grid.Column="1" RowDefinitions="Auto,Auto">
                                        <Label x:Name="nameLabel"
                                   Grid.Row="0"
                                   Text="{Binding Name}"
                                   FontSize="14"
                                   TextColor="{StaticResource ClrTextMain}" />

                                        <HorizontalStackLayout Grid.Row="1" Spacing="12">
                                            <Label x:Name="endLabel"
                                       Text="{Binding End}"
                                       FontSize="12"
                                       TextColor="{StaticResource ClrTextSub}"/>
                                            <Label x:Name="statusLabel"
                                       Text="{Binding StatusText}"
                                       FontSize="12"
                                       TextColor="{StaticResource ClrTextSub}" />
                                        </HorizontalStackLayout>
                                    </Grid>

                                    <!-- æ ¹æ® StatusText æŽ§åˆ¶æ ·å¼ -->
                                    <Grid.Triggers>

                                        <!-- âœ… å®Œæˆï¼šç©ºå¿ƒè“åœˆ + è“å¯¹å‹¾ + è“è‰²ç«–çº¿/æ–‡å­— -->
                                        <DataTrigger TargetType="Grid" Binding="{Binding StatusText}" Value="å®Œæˆ">
                                            <Setter TargetName="dotBorder" Property="Ellipse.Stroke" Value="{StaticResource ClrBlue}" />
                                            <Setter TargetName="dotBorder" Property="Ellipse.StrokeThickness" Value="4" />
                                            <Setter TargetName="dotBorder" Property="Ellipse.Fill" Value="{StaticResource ClrLine}" />
                                            <Setter TargetName="dotText"   Property="Label.Text"     Value="âœ”" />
                                            <Setter TargetName="dotText"   Property="Label.TextColor" Value="{StaticResource ClrBlue}" />
                                            <Setter TargetName="dotText"   Property="Label.FontAttributes" Value="Bold" />
                                            <Setter TargetName="dotLine"   Property="BoxView.Color"  Value="{StaticResource ClrBlue}" />
                                            <Setter TargetName="nameLabel" Property="Label.TextColor" Value="{StaticResource ClrBlue}" />
                                            <Setter TargetName="statusLabel" Property="Label.TextColor" Value="{StaticResource ClrBlue}" />
                                        </DataTrigger>

                                        <!-- ðŸ”µ è¿›è¡Œä¸­ï¼šå®žå¿ƒè“åœˆ + ç™½å­—æ•°å­— + è“çº¿ï¼Œæ ‡é¢˜/æ—¥æœŸåŠ ç²— -->
                                        <DataTrigger TargetType="Grid" Binding="{Binding StatusText}" Value="è¿›è¡Œä¸­">
                                            <Setter TargetName="dotBorder" Property="Ellipse.Stroke" Value="{StaticResource ClrBlue}" />
                                            <Setter TargetName="dotBorder" Property="Ellipse.StrokeThickness" Value="4" />
                                            <Setter TargetName="dotBorder" Property="Ellipse.Fill" Value="{StaticResource ClrBlue}" />
                                            <Setter TargetName="dotText"   Property="Label.TextColor" Value="White" />
                                            <Setter TargetName="dotText"   Property="Label.FontAttributes" Value="Bold" />
                                            <Setter TargetName="dotLine"   Property="BoxView.Color"  Value="{StaticResource ClrBlue}" />

                                            <Setter TargetName="nameLabel" Property="Label.FontAttributes" Value="Bold" />
                                            <Setter TargetName="endLabel"  Property="Label.FontAttributes" Value="Bold" />
                                            <Setter TargetName="nameLabel" Property="Label.TextColor" Value="{StaticResource ClrTextMain}" />
                                            <Setter TargetName="endLabel"  Property="Label.TextColor" Value="{StaticResource ClrTextMain}" />
                                            <Setter TargetName="statusLabel" Property="Label.TextColor" Value="{StaticResource ClrBlue}" />
                                        </DataTrigger>

                                        <!-- âšª æœªå¼€å§‹ï¼šç°è‰²ç©ºå¿ƒåœ† + ç°å­—æ•°å­— + ç°çº¿ -->
                                        <DataTrigger TargetType="Grid" Binding="{Binding StatusText}" Value="æœªå¼€å§‹">
                                            <Setter TargetName="dotBorder" Property="Ellipse.Stroke" Value="{StaticResource ClrLine}" />
                                            <Setter TargetName="dotBorder" Property="Ellipse.StrokeThickness" Value="4" />
                                            <Setter TargetName="dotBorder" Property="Ellipse.Fill" Value="{StaticResource ClrTextSub}" />
                                            <Setter TargetName="dotText"   Property="Label.TextColor" Value="#C0C4CC" />
                                            <Setter TargetName="dotText"   Property="Label.FontAttributes" Value="None" />
                                            <Setter TargetName="dotLine"   Property="BoxView.Color"  Value="{StaticResource ClrLine}" />

                                            <Setter TargetName="nameLabel" Property="Label.TextColor" Value="{StaticResource ClrTextSub}" />
                                            <Setter TargetName="endLabel"  Property="Label.TextColor" Value="{StaticResource ClrTextSub}" />
                                            <Setter TargetName="statusLabel" Property="Label.TextColor" Value="{StaticResource ClrTextSub}" />
                                        </DataTrigger>

                                    </Grid.Triggers>

                               
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                </VerticalStackLayout>
            </Frame>
        </Grid>
    </ScrollView>
</ContentPage>
